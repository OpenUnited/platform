<div class="mt-5">
    <div id="loading-spinner" class="flex justify-center items-center mt-4 mb-4 htmx-indicator">
        <img src="{{ static('images/loading.svg') }}" width="32" height="32" />
    </div>

    <form method="POST" action="{{ url('portal:product-settings', args=(product.slug,)) }}">
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
        
        <div class="form-group mb-4">
            <label class="form-label">Ownership Type</label>
            <div class="mt-2">
                {% for value, label in form.owner_type.field.choices %}
                    <div class="form-check">
                        <input type="radio" 
                               name="owner_type" 
                               value="{{ value }}" 
                               id="owner_type_{{ value }}"
                               class="form-check-input"
                               {% if form.owner_type.value() == value %}checked{% endif %}>
                        <label class="form-check-label" for="owner_type_{{ value }}">
                            {{ label }}
                        </label>
                    </div>
                {% endfor %}
            </div>
            {% if form.owner_type.errors %}
                <div class="error">{{ form.owner_type.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group mb-4" id="person_field" style="display: none;">
            <label for="{{ form.person.id_for_label }}">Person</label>
            {{ form.person }}
            {% if form.person.errors %}
                <div class="error">{{ form.person.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group mb-4" id="organisation_field" style="display: none;">
            <label for="{{ form.organisation.id_for_label }}">Organisation</label>
            {{ form.organisation }}
            {% if form.organisation.errors %}
                <div class="error">{{ form.organisation.errors[0] }}</div>
            {% endif %}
        </div>
        
        <div class="form-group mb-4">
            <label for="{{ form.name.id_for_label }}">Name</label>
            {{ form.name }}
            {% if form.name.errors %}
                <div class="error">{{ form.name.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group mb-4">
            <label for="{{ form.short_description.id_for_label }}">Short Description</label>
            {{ form.short_description }}
            {% if form.short_description.errors %}
                <div class="error">{{ form.short_description.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group mb-4">
            <label for="{{ form.full_description.id_for_label }}">Full Description</label>
            {{ form.full_description }}
            {% if form.full_description.errors %}
                <div class="error">{{ form.full_description.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group mb-4">
            <label for="{{ form.visibility.id_for_label }}">Visibility</label>
            {{ form.visibility }}
            {% if form.visibility.errors %}
                <div class="error">{{ form.visibility.errors[0] }}</div>
            {% endif %}
            {% if form.visibility.help_text %}
                <small class="form-text text-muted">{{ form.visibility.help_text }}</small>
            {% endif %}
        </div>

        <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ownerTypeInputs = document.querySelectorAll('input[name="owner_type"]');
    const personField = document.getElementById('person_field');
    const orgField = document.getElementById('organisation_field');

    function updateOwnerFields() {
        const selectedType = document.querySelector('input[name="owner_type"]:checked').value;
        if (selectedType === 'person') {
            personField.style.display = 'block';
            orgField.style.display = 'none';
        } else {
            personField.style.display = 'none';
            orgField.style.display = 'block';
        }
    }

    ownerTypeInputs.forEach(input => {
        input.addEventListener('change', updateOwnerFields);
    });

    // Initial state
    updateOwnerFields();
});
</script>
