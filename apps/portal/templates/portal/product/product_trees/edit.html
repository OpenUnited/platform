{% extends 'portal/base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-2xl mb-4">Edit Product Tree</h1>
    
    <!-- Convert tree_data to a JavaScript object literal -->
    <script>
        window.initialTreeData = JSON.parse('{{ tree_data|escapejs }}');
        console.log('Initial tree data:', window.initialTreeData);
    </script>
    
    <div x-data="{ 
        tree: window.initialTreeData,
        updatedTree: JSON.parse(JSON.stringify(window.initialTreeData)),
        
        init() {
            console.log('Initial tree data:', this.tree);
            console.log('Editable tree data:', this.updatedTree);
        },
        
        renderNode(node, depth = 0) {
            if (!node) return '';
            
            const childrenHtml = node.children?.length 
                ? `<div class='collapse-content'>
                    <div class='space-y-2'>
                        ${node.children.map(child => this.renderNode(child, depth + 1)).join('')}
                    </div>
                   </div>`
                : '';
            
            return `
                <div class='collapse bg-base-100 ${depth > 0 ? 'ml-4' : ''} ${node.children?.length ? 'collapse-arrow' : ''}'>
                    <input type='checkbox' 
                           class='collapse-toggle' 
                           ${node.children?.length ? '' : 'hidden'}>
                    <div class='collapse-title py-2'>
                        <div class='flex items-center justify-between'>
                            <div>
                                <h${depth + 3} class='font-bold ${depth === 0 ? 'text-xl' : 'text-base'}'>${node.name}</h${depth + 3}>
                                <p class='text-base-content/70 text-sm'>${node.description || ''}</p>
                            </div>
                            ${node.lens_type ? `<span class='badge badge-outline badge-sm'>${node.lens_type}</span>` : ''}
                        </div>
                    </div>
                    ${childrenHtml}
                </div>
            `;
        }
    }">
        <!-- Root Node -->
        <template x-if="updatedTree">
            <div class="space-y-2" x-html="renderNode(updatedTree)"></div>
        </template>
    </div>
</div>
{% endblock %}

m,